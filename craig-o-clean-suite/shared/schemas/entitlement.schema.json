{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://craig-o-clean.vibecaas.com/schemas/entitlement.json",
  "title": "Entitlement",
  "description": "Cross-platform entitlement/subscription schema for Craig-O-Clean Suite",
  "type": "object",
  "required": ["userId", "status", "tier"],
  "properties": {
    "userId": {
      "type": "string",
      "description": "Unique user identifier"
    },
    "status": {
      "$ref": "#/definitions/EntitlementStatus"
    },
    "tier": {
      "$ref": "#/definitions/SubscriptionTier"
    },
    "source": {
      "$ref": "#/definitions/BillingSource"
    },
    "trialInfo": {
      "$ref": "#/definitions/TrialInfo"
    },
    "subscriptionInfo": {
      "$ref": "#/definitions/SubscriptionInfo"
    },
    "features": {
      "$ref": "#/definitions/FeatureFlags"
    },
    "lastVerified": {
      "type": "string",
      "format": "date-time",
      "description": "Last time entitlement was verified with server"
    },
    "offlineGraceExpiry": {
      "type": "string",
      "format": "date-time",
      "description": "When offline grace period expires"
    }
  },
  "definitions": {
    "EntitlementStatus": {
      "type": "string",
      "enum": [
        "free",
        "trial_active",
        "trial_expired",
        "subscribed",
        "subscription_expired",
        "subscription_grace_period",
        "subscription_paused"
      ],
      "description": "Current entitlement status"
    },
    "SubscriptionTier": {
      "type": "string",
      "enum": ["free", "trial", "monthly", "yearly"],
      "description": "Subscription tier"
    },
    "BillingSource": {
      "type": "string",
      "enum": [
        "none",
        "google_play",
        "apple_app_store",
        "microsoft_store",
        "stripe"
      ],
      "description": "Billing provider source"
    },
    "TrialInfo": {
      "type": "object",
      "properties": {
        "startDate": {
          "type": "string",
          "format": "date-time",
          "description": "Trial start date"
        },
        "endDate": {
          "type": "string",
          "format": "date-time",
          "description": "Trial end date"
        },
        "daysRemaining": {
          "type": "integer",
          "minimum": 0,
          "description": "Days remaining in trial"
        },
        "hasUsedTrial": {
          "type": "boolean",
          "description": "Whether user has used their trial"
        }
      }
    },
    "SubscriptionInfo": {
      "type": "object",
      "properties": {
        "productId": {
          "type": "string",
          "description": "Subscription product identifier"
        },
        "purchaseToken": {
          "type": "string",
          "description": "Purchase token from store"
        },
        "startDate": {
          "type": "string",
          "format": "date-time",
          "description": "Subscription start date"
        },
        "currentPeriodEnd": {
          "type": "string",
          "format": "date-time",
          "description": "Current billing period end"
        },
        "autoRenewing": {
          "type": "boolean",
          "description": "Whether subscription auto-renews"
        },
        "cancelAtPeriodEnd": {
          "type": "boolean",
          "description": "Whether subscription cancels at period end"
        },
        "priceAmount": {
          "type": "number",
          "description": "Price amount in currency"
        },
        "priceCurrency": {
          "type": "string",
          "description": "ISO 4217 currency code"
        }
      }
    },
    "FeatureFlags": {
      "type": "object",
      "properties": {
        "canViewMetrics": {
          "type": "boolean",
          "default": true,
          "description": "Can view system metrics"
        },
        "canViewProcessList": {
          "type": "boolean",
          "default": true,
          "description": "Can view process list"
        },
        "canEndProcesses": {
          "type": "boolean",
          "default": false,
          "description": "Can end/kill processes"
        },
        "canUseQuickActions": {
          "type": "boolean",
          "default": false,
          "description": "Can use quick actions from tray/notification"
        },
        "canBulkCleanup": {
          "type": "boolean",
          "default": false,
          "description": "Can perform bulk cleanup actions"
        },
        "canAdvancedCleanup": {
          "type": "boolean",
          "default": false,
          "description": "Can use advanced cleanup tools"
        }
      },
      "description": "Feature access flags"
    }
  }
}
